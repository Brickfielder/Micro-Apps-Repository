<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Micro Rehab Apps</title>
  <style>
    :root {
      --bg: #f7f7f9;
      --card: #ffffff;
      --text: #1f2937;
      --muted: #616b74;
      --brand: #0a66c2;
      --brand-hover: #084f96;
      --shadow: 0 10px 24px rgba(0,0,0,0.10);
      --radius: 16px;
      --divider: #e9edf3;
      --pill: #f0f2f5;
      --thumb: #f6f7fb;
      --corrugation: repeating-linear-gradient(
        0deg,
        rgba(0,0,0,0.03) 0px,
        rgba(0,0,0,0.03) 1px,
        transparent 1px,
        transparent 6px
      );
    }
    @media(prefers-color-scheme: dark){
      :root {
        --bg: #0b0f14;
        --card: #0f141a;
        --text: #e6edf3;
        --muted: #9aa4af;
        --brand: #78b7ff;
        --brand-hover: #a4cfff;
        --divider: #16202a;
        --pill:#101820;
        --thumb:#0e151c;
      }
    }
    [data-theme="dark"]{
      --bg: #0b0f14;
      --card: #0f141a;
      --text: #e6edf3;
      --muted: #9aa4af;
      --brand: #78b7ff;
      --brand-hover: #a4cfff;
      --divider: #16202a;
      --pill:#101820;
      --thumb:#0e151c;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      line-height: 1.45;
      background-image: var(--corrugation);
    }

    /* Header */
    header {
      position: sticky; top: 0; z-index: 50;
      backdrop-filter: saturate(1.2) blur(6px);
      background: color-mix(in oklab, var(--bg) 92%, transparent);
      border-bottom: 1px solid var(--divider);
    }
    .row {
      max-width: 1100px;
      margin: 0 auto;
      padding: 14px 16px;
      display: grid;
      grid-template-columns: 1fr auto auto;
      gap: 12px;
      align-items: center;
    }
    .brand {
      display: flex; align-items: center; gap: 12px;
    }
    .brand .logo {
      width: 36px; height: 36px; border-radius: 10px;
      display: grid; place-items: center;
      background: var(--thumb);
      box-shadow: inset 0 0 0 1px var(--divider);
      font-size: 20px;
    }
    .brand h1 {
      margin: 0; font-size: 18px; letter-spacing: .2px;
    }
    .sub { color: var(--muted); font-size: 12px; margin-top: 2px; }

    .controls {
      display: flex; gap: 10px; align-items: center;
    }
    .search {
      min-width: 220px;
      background: var(--card);
      border: 1px solid var(--divider);
      padding: 8px 10px;
      border-radius: 999px;
      display: flex; align-items: center; gap: 8px;
      box-shadow: var(--shadow);
    }
    .search input {
      border: 0; outline: none; background: transparent; color: var(--text);
      width: 160px;
    }
    .toggle {
      display: inline-flex; align-items: center; gap: 8px;
      border-radius: 999px; padding: 8px 12px;
      background: var(--card);
      border: 1px solid var(--divider);
      cursor: pointer;
      user-select: none;
    }
    .toggle .dot {
      width: 18px; height: 18px; border-radius: 50%;
      background: var(--thumb);
      border: 1px solid var(--divider);
      display: inline-grid; place-items: center;
      font-size: 12px;
    }

    /* Hero */
    .hero {
      max-width: 920px; margin: 22px auto 8px; padding: 0 16px;
      text-align: center;
    }
    .hero h2 { margin: 10px 0 6px; font-size: 28px; }
    .hero p { margin: 0 auto; max-width: 780px; color: var(--muted); text-align: justify; }

    /* Grid */
    section.grid {
      max-width: 1100px; margin: 18px auto 56px; padding: 0 16px;
    }
    .cards {
      display: grid; grid-template-columns: repeat( auto-fit, minmax(260px, 1fr) );
      gap: 16px;
    }
    .card {
      display: grid; grid-template-rows: auto auto 1fr auto auto;
      gap: 10px;
      padding: 16px;
      border-radius: var(--radius);
      background: var(--card);
      border: 1px solid var(--divider);
      box-shadow: var(--shadow);
      min-height: 230px;
    }
    .thumb {
      width: 52px; height: 52px; border-radius: 14px;
      background: var(--thumb);
      display: grid; place-items: center;
      font-size: 26px;
      box-shadow: inset 0 0 0 1px var(--divider);
    }
    .card h3 { margin: 0; font-size: 18px; }
    .card p.desc { margin: 0; color: var(--muted); text-align: justify; }
    .tags { display:flex; flex-wrap: wrap; gap:6px; margin-top: 6px; }
    .tag { background: var(--pill); border:1px solid var(--divider); padding:4px 8px; border-radius:999px; font-size:12px; }
    .open {
      display: inline-flex; align-items: center; gap: 6px;
      width: max-content;
      padding: 10px 12px; border-radius: 12px;
      background: var(--brand); color: #fff; text-decoration: none; font-weight: 600;
      margin-top: 4px;
    }
    .open:hover { background: var(--brand-hover); }

    footer {
      max-width: 1100px; margin: 24px auto 40px; padding: 0 16px; color: var(--muted);
      display:flex; justify-content: space-between; align-items:center; gap:12px;
    }
    @media (max-width: 640px) {
      .row { grid-template-columns: 1fr auto; }
      .controls { grid-column: 1 / -1; justify-content: space-between; }
      .search { width: 100%; }
      .search input { width: 100%; }
    }
  </style>
</head>
<body>
  <header>
    <div class="row">
      <div class="brand" role="banner">
        <div class="logo" aria-hidden="true">üß©</div>
        <div>
          <h1>Micro Rehab Apps</h1>
          <div class="sub">Lightweight, browser‚Äëbased cognitive tools</div>
        </div>
      </div>

      <div class="controls" role="region" aria-label="Controls">
        <div class="search" role="search">
          <span aria-hidden="true">üîé</span>
          <input id="search" type="search" placeholder="Search apps or tags‚Ä¶" autocomplete="off" />
        </div>
        <button id="themeToggle" class="toggle" type="button" aria-pressed="false" aria-label="Toggle dark mode">
          <span class="dot" aria-hidden="true">‚óê</span>
          <span class="lab">Theme</span>
        </button>
      </div>
    </div>
  </header>

  <main>
    <div class="hero">
      <h2>Practice, measure, iterate.</h2>
      <p>
        A curated set of small, focused web apps for visuospatial skills, language, and executive functioning.
        Everything runs locally in your browser ‚Äî no installs. Links open the live app in its folder. 
        Use the search to filter by name or tag.
      </p>
    </div>

    <section class="grid">
      <div id="cards" class="cards" role="list"></div>
    </section>
  </main>

  <footer>
    <div>Updated 15 Sep 2025 ¬∑ JSON‚Äëdriven</div>
    <div><a href="catalog.json" target="_blank" rel="noopener">View catalog.json</a></div>
  </footer>

  <script>
    // --- Utilities ---
    function normalizePath(p){
      if(!p) return null;
      // Ensure directories (no index.html) and use the new repository root
      p = p.replace(/\\/index\\.html$/i,'/');
      p = p.replace(/^\\/?docs\\//i, '/micro-apps-repository/');
      // If already correct prefix, keep it
      if(!/^\\/?micro-apps-repository\\//i.test(p.replace(/^\\//,''))){
        // leave as-is if it's an absolute URL or already good
      }
      // Guarantee trailing slash
      if(!p.endsWith('/')) p += '/';
      return p;
    }

    function el(tag, attrs={}, ...children){
      const n = document.createElement(tag);
      Object.entries(attrs).forEach(([k,v])=>{
        if(v===null || v===undefined) return;
        if(k==='class') n.className = v;
        else if(k==='dataset'){ Object.assign(n.dataset, v); }
        else if(k.startsWith('on') && typeof v==='function'){ n.addEventListener(k.substring(2), v); }
        else n.setAttribute(k, v);
      });
      children.flat().forEach(c=>{
        if(c==null) return;
        n.appendChild(typeof c==='string' ? document.createTextNode(c) : c);
      });
      return n;
    }

    // --- Fallback master list to guarantee 13 apps appear ---
    const FALLBACK = [
      {name:"Audio Errands", path:"/micro-apps-repository/Audio_Errands/", tags:["Executive Functioning","Strategy Training"], icon:"üîä", about:"Follow spoken multi-step instructions under time pressure."},
      {name:"Barista Chaos", path:"/micro-apps-repository/Barista_Chaos/", tags:["Executive Functioning"], icon:"‚òï", about:"Rule-based drink making with distractors; inhibition & working memory."},
      {name:"Build your package", path:"/micro-apps-repository/Build_your_package/", tags:["Utility"], icon:"üì¶", about:"Bundle selected apps (utility)."},
      {name:"Emergency despatch", path:"/micro-apps-repository/Emergency_despatch/", tags:["Executive Functioning","Visuospatial"], icon:"üöë", about:"Triage and route under constraints; scanning & updating."},
      {name:"Errands ‚Äî visual memory", path:"/micro-apps-repository/Errands-visual-memory/", tags:["Visuospatial","Executive Functioning"], icon:"üß†", about:"Remember locations and complete a list efficiently."},
      {name:"Fluency Coach", path:"/micro-apps-repository/Fluency_Coach/", tags:["Language","Executive Functioning","Strategy Training"], icon:"üí¨", about:"Category & letter fluency with cueing strategies."},
      {name:"Office Day", path:"/micro-apps-repository/Office_Day/", tags:["Executive Functioning","Strategy Training"], icon:"üóÇÔ∏è", about:"Simulated office tasks with interruptions."},
      {name:"Plan with Coco", path:"/micro-apps-repository/Plan_with_Coco/", tags:["Executive Functioning","Language"], icon:"üïäÔ∏è", about:"Plan with Coco through choices and distractors."},
      {name:"Star Hunt", path:"/micro-apps-repository/Star_Hunt/", tags:["Visuospatial"], icon:"‚≠ê", about:"Find target stars; visual search & speed."},
      {name:"Taskflow", path:"/micro-apps-repository/Taskflow/", tags:["Executive Functioning"], icon:"üß≠", about:"Plan and order tasks; sequence memory."},
      {name:"Tower control", path:"/micro-apps-repository/Tower_control/", tags:["Executive Functioning","Visuospatial"], icon:"üõ´", about:"Deconflict and route aircraft under rules."},
      {name:"Visuospatial Blocks", path:"/micro-apps-repository/Visuospatial_Blocks/", tags:["Visuospatial"], icon:"üß±", about:"Recreate block patterns; constructional praxis."},
      {name:"Word Scavenger", path:"/micro-apps-repository/word-scavenger/", tags:["Language"], icon:"üî§", about:"Search and collect words under constraints."},
      {name:"Maze Explorer", path:"/micro-apps-repository/maze-explorer/", tags:["Visuospatial","Executive Functioning"], icon:"üó∫Ô∏è", about:"Navigate mazes with evolving rules."}
    ];

    // Some repos have both kebab-case and underscore names; ensure all 13 appear:
    const MUST_HAVE = new Map(FALLBACK.map(x => [x.name.toLowerCase(), x]));

    // --- Render ---
    const cardsEl = document.getElementById('cards');
    let ITEMS = [];

    function render(list){
      cardsEl.innerHTML = '';
      list.forEach(app => {
        const art = el('article', {class:'card', role:'listitem', dataset:{name:app.name}},
          el('div', {class:'thumb','aria-hidden':'true'}, app.icon || 'üß©'),
          el('h3', {}, app.name),
          el('p', {class:'desc'}, app.about || 'A lightweight browser app.'),
          el('div', {class:'tags'}, ...(app.tags||[]).map(t=>el('span',{class:'tag'}, t))),
          el('a', {class:'open', href: normalizePath(app.path) || '#', target:'_blank', rel:'noopener'}, 'Open ', el('span',{class:'chev','aria-hidden':'true'}, '‚Ä∫')),
        );
        cardsEl.appendChild(art);
      });
    }

    function matches(q, app){
      if(!q) return true;
      q = q.toLowerCase();
      const hay = [app.name, app.about, ...(app.tags||[])].join(' ').toLowerCase();
      return hay.includes(q);
    }

    // --- Search ---
    const search = document.getElementById('search');
    search.addEventListener('input', () => {
      const q = search.value.trim();
      render(ITEMS.filter(a => matches(q, a)));
    });

    // --- Theme toggle ---
    const toggle = document.getElementById('themeToggle');
    function applyTheme(t){ document.documentElement.dataset.theme = t; toggle.setAttribute('aria-pressed', t==='dark'); }
    (function initTheme(){
      const saved = localStorage.getItem('mr.theme');
      if(saved){ applyTheme(saved); }
    })();
    toggle.addEventListener('click', () => {
      const next = (document.documentElement.dataset.theme === 'dark') ? 'light' : 'dark';
      applyTheme(next); localStorage.setItem('mr.theme', next);
    });

    // --- Load catalog.json then merge with FALLBACK to ensure completeness ---
    async function load(){
      let cat = [];
      try {
        const res = await fetch('catalog.json', {cache:'no-store'});
        if(res.ok){ cat = await res.json(); }
      } catch(e){ /* ignore, fallback will kick in */ }

      // Map catalog to standard shape
      const mapped = (Array.isArray(cat)?cat:[]).map(it => ({
        name: it.name || it.title || 'Untitled App',
        path: normalizePath(it.path || it.url) || null,
        tags: it.tags || [],
        about: it.about || it.description || '',
        icon: it.icon || null
      }));

      // Normalize prefixes and ensure Coco path rule
      mapped.forEach(m => {
        if(m.name.toLowerCase().includes('plan') && m.name.toLowerCase().includes('coco')){
          m.path = normalizePath('/micro-apps-repository/Plan_with_Coco/');
        }
      });

      // Merge: prefer catalog entries, fill gaps with fallback, and ensure all MUST_HAVE exist
      const byName = new Map();
      [...mapped, ...FALLBACK].forEach(x => {
        const key = x.name.toLowerCase();
        const prev = byName.get(key) || {};
        byName.set(key, Object.assign({}, prev, x));
      });

      // Guarantee the 13 essentials
      MUST_HAVE.forEach((v,k)=>{
        if(!byName.has(k)) byName.set(k, v);
      });

      ITEMS = Array.from(byName.values()).filter(x => x.path);
      // Sort by name
      ITEMS.sort((a,b)=>a.name.localeCompare(b.name));

      render(ITEMS);
    }
    load();
  </script>
</body>
</html>

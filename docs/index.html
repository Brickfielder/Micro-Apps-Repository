<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Micro Rehab Apps</title>
<meta name="description" content="Browse lightweight cognitive rehab micro-apps: visuospatial, executive functioning, language, strategy training." />
<style>
  :root{
    color-scheme: light dark;
    --bg:#f7f8fb; --surface:#fff; --text:#1f2937; --muted:#6b7280; --line:#e5e7eb;
    --accent:#ff7a6e; --accent-600:#ff6254; --accent-700:#f24f40;
    --pill:#f2f4f7; --radius:16px;
    --shadow:0 1px 2px rgba(16,24,40,.06),0 8px 24px rgba(16,24,40,.08);
    --maxw:1200px;
  }
  html,body{height:100%} *{box-sizing:border-box}
  body{
    margin:0; font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,"Helvetica Neue",Arial;
    color:var(--text); background:var(--bg);
    background-image:repeating-linear-gradient(0deg,rgba(210,180,140,.15) 0px,rgba(210,180,140,.15) 1px,transparent 1px,transparent 6px);
    background-size:100% 6px;
  }

  /* Header / nav */
  header{position:sticky;top:0;z-index:50;background:rgba(255,255,255,.9);
          backdrop-filter:saturate(120%) blur(8px);border-bottom:1px solid var(--line)}
  .nav{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;gap:12px;
       max-width:var(--maxw);margin:0 auto;padding:14px 16px}
  .brand{justify-self:flex-start;display:flex;align-items:center;gap:10px;text-decoration:none;color:inherit}
  .logo{width:28px;height:28px;border-radius:8px;background:linear-gradient(135deg,var(--accent),var(--accent-700));box-shadow:0 2px 8px rgba(242,79,64,.35)}
  nav a{margin:0 10px;text-decoration:none;color:inherit}
  .ghost,.cta{border-radius:12px;padding:10px 14px;font-weight:600;cursor:pointer}
  .ghost{background:transparent;border:1px solid var(--line)}
  .cta{background:var(--accent);color:#fff;border:0;box-shadow:0 6px 16px rgba(242,79,64,.25)}

  /* Hero */
  .hero{
    max-width:var(--maxw);
    margin:0 auto;
    padding:48px 16px 20px;
    display:grid;
    gap:16px;
  }
  .eyebrow{display:inline-block;padding:6px 10px;border-radius:999px;background:var(--pill);
           font-size:12px;color:var(--muted);text-transform:uppercase;letter-spacing:.3px}

  h1{
    margin:8px 0 4px;
    font-size: clamp(32px, 6vw, 64px);
    line-height: 1.05;
    text-wrap: balance;
  }

  .sub{
    color:var(--muted);
    font-size:1.05rem;
    line-height:1.55;
    text-align:justify;
    text-justify:inter-word;
    hyphens:auto;
    -webkit-hyphens:auto;
    -ms-hyphens:auto;
  }

  /* Sections */
  .section,.featured-wrap,.filters{max-width:var(--maxw);margin:6px auto 0;padding:4px 16px}
  .strip{display:flex;gap:16px;overflow:auto;padding-bottom:10px;scroll-snap-type:x mandatory}
  .feature-card{min-width:280px;background:var(--surface);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);padding:14px;display:grid;gap:8px;scroll-snap-align:start}
  .badge{display:inline-flex;gap:6px;padding:4px 10px;border-radius:999px;background:rgba(255,122,110,.12);color:#b42318;font-weight:600;font-size:12px}

  .filters{position:sticky;top:64px;z-index:30;background:var(--bg);border-top:1px solid var(--line)}
  .bar{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .search{flex:1 1 260px;display:flex;gap:8px;align-items:center;background:var(--surface);border:1px solid var(--line);border-radius:12px;padding:10px 12px}
  .search input{border:0;outline:0;background:transparent;width:100%}
  .chip{border:1px solid var(--line);background:var(--pill);padding:8px 12px;border-radius:999px;cursor:pointer;font-weight:600}
  .chip[aria-pressed="true"]{background:rgba(255,122,110,.14);border-color:var(--accent-600)}

  .grid{display:grid;gap:16px;grid-template-columns:repeat(12,1fr)}
  @media (max-width:1200px){.grid{grid-template-columns:repeat(8,1fr)}}
  @media (max-width:840px){.grid{grid-template-columns:repeat(6,1fr)}}
  @media (max-width:620px){.grid{grid-template-columns:repeat(4,1fr)}}
  @media (max-width:420px){.grid{grid-template-columns:repeat(2,1fr)}}
  .card{grid-column:span 4;display:grid;gap:10px;padding:14px;background:var(--surface);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow)}
  .thumb{height:120px;border-radius:12px;border:1px solid var(--line);display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,rgba(255,122,110,.08),transparent);font-size:34px}
  .desc{color:var(--muted);font-size:14px;line-height:1.4;margin:0}
  .tag{background:var(--pill);border:1px solid var(--line);border-radius:999px;padding:4px 8px;font-size:12px;font-weight:600;margin-right:6px}
  .open{margin-top:auto;display:inline-flex;gap:8px;text-decoration:none;font-weight:700;color:var(--accent-700)}

  footer{margin-top:20px;border-top:1px solid var(--line);background:var(--surface)}
  .foot{max-width:var(--maxw);margin:0 auto;padding:20px 16px;display:grid;grid-template-columns:1.5fr 1fr 1fr;gap:16px}
  .foot small{color:var(--muted)} @media (max-width:800px){.foot{grid-template-columns:1fr}}

  /* Dark theme */
  html[data-theme="dark"]{
    --bg:#0b1220; --surface:#111827; --text:#f9fafb; --muted:#cbd5e1; --line:#1f2937; --pill:#0f172a;
    --shadow:0 1px 2px rgba(0,0,0,.7),0 8px 24px rgba(0,0,0,.5);
    --accent:#ff7a6e; --accent-600:#ff6254; --accent-700:#ff4b3a;
  }
  html[data-theme="dark"] body{background-image:repeating-linear-gradient(0deg,rgba(255,255,255,.06) 0px,rgba(255,255,255,.06) 1px,transparent 1px,transparent 6px)}
  html[data-theme="dark"] .badge{background:rgba(255,122,110,.18);color:#ffd0cb}
  html[data-theme="dark"] .open{color:var(--accent-600)}
/* Hero should match the grid container width */
.hero{
  max-width: var(--maxw);     /* same as .section/.featured/.filters */
  margin: 0 auto;
  padding-inline: 16px;       /* same side padding as the grid sections */
}
</style>
</head>
<body>
<header role="banner">
  <div class="nav">
    <a class="brand" href="#top" aria-label="Micro Rehab Apps home">
      <span class="logo" aria-hidden="true"></span><span>Micro Rehab Apps</span>
    </a>
    <nav aria-label="Primary">
      <a href="#apps">Apps</a>
      <a href="#about">About</a>
      <a href="#contact">Contact</a>
    </nav>
    <button id="themeToggle" class="ghost" aria-pressed="false" title="Toggle theme">Theme: Light</button>
  </div>
</header>

<main id="top" role="main">
  <section class="hero" aria-label="Intro">
    <span class="eyebrow">Open micro-apps for cognitive rehab</span>
    <h1>Practice, track, and iterate â€” with lightweight tools that patients actually use.</h1>
    <p class="sub">These micro-apps are prototypes in active development. They have been tested primarily on desktop browsers, and some functions may not work as expected on tablets or mobile devices. If you encounter issues, or if youâ€™d like to suggest improvements, please get in touch â€” your feedback directly shapes how these tools evolve.</p>
    <div class="hero-actions" style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
      <button class="cta" onclick="document.getElementById('apps').scrollIntoView({behavior:'smooth'})">Browse apps</button>
      <button class="ghost" onclick="document.getElementById('how').scrollIntoView({behavior:'smooth'})">How it works</button>
      <span class="meta" style="color:var(--muted)">â€¢ Neutral palette + coral accent â€¢ Accessible by default</span>
    </div>
  </section>

  <!-- Featured (populated from JSON) -->
  <section class="featured-wrap" aria-label="Featured">
    <div id="featuredStrip" class="strip" role="list"></div>
  </section>

  <!-- Filters -->
  <section class="filters" aria-label="Filters">
    <div class="bar">
      <div class="search" role="search">
        <span aria-hidden="true">ðŸ”Ž</span>
        <input id="q" type="search" placeholder="Search apps, tags, or featuresâ€¦" aria-label="Search apps"/>
      </div>
      <div id="tagBar" class="chips" role="toolbar" aria-label="Filter by tag"></div>
    </div>
  </section>

  <!-- Grid (populated from JSON) -->
  <section id="apps" class="section" aria-labelledby="apps-h2">
    <h2 id="apps-h2">All apps</h2>
    <p id="how" class="lead">Tap a tag to filter. Multiple tags apply together (intersection). Type in the search box to search name/description/tags.</p>
    <div id="grid" class="grid" role="list"></div>
  </section>

  <section id="about" class="section" aria-label="About">
    <h2>How it works</h2>
    <p class="lead"><code>index.html</code> fetches <code>catalog.json</code> (same folder) and renders the featured items and the grid. To add a tool, edit the JSON â€” no HTML changes needed.</p>
  </section>

  <section id="contact" class="section" aria-label="Contact">
    <h2>Contact</h2>
    <p class="lead">Questions or collaboration ideas? Email <a href="mailto:m.mion@nhs.net">m.mion@nhs.net</a>.</p>
  </section>
</main>

<footer role="contentinfo">
  <div class="foot">
    <div>
      <strong>Micro Rehab Apps</strong><br/>
      <small>Open micro-apps for cognitive rehabilitation and research. Apache-2.0.</small>
    </div>
    <div>
      <small>Repository</small><br/>
      <a class="open" href="https://github.com/yourname/micro-apps">GitHub <span class="chev">â€º</span></a>
    </div>
    <div>
      <small>Version</small><br/>
      <small>v1.4 Â· Hero matches grid width</small>
    </div>
  </div>
</footer>

<script>
  // Theme toggle
  (function(){
    const root=document.documentElement,btn=document.getElementById('themeToggle'),key='mra-theme';
    const saved=localStorage.getItem(key);
    const set=(m)=>{root.setAttribute('data-theme',m);btn.textContent='Theme: '+(m==='dark'?'Dark':'Light');btn.setAttribute('aria-pressed',m==='dark')}
    set(saved==='dark'?'dark':'light');
    btn.addEventListener('click',()=>set(root.getAttribute('data-theme')==='dark'?'light':'dark'));
  })();

  // Helpers
  const $ = (sel)=>document.querySelector(sel);
  const grid = $('#grid'), strip = $('#featuredStrip'), q = $('#q'), tagBar = $('#tagBar');
  let DATA = [], ACTIVE_TAGS = new Set(), CARD_INDEX = new Map(), ALL_TAGS = [];

  function cardHTML(a){
    const tagsHTML = a.tags.map(t=>`<span class="tag">${t}</span>`).join('');
    return `<article class="card" role="listitem" data-tags='${JSON.stringify(a.tags)}'>
      <div class="thumb" aria-hidden="true">${a.thumb||'ðŸ§©'}</div>
      <h3>${a.name}</h3>
      <p class="desc">${a.desc}</p>
      <div class="tags">${tagsHTML}</div>
      <a class="open" href="${a.path}">Open <span class="chev">â€º</span></a>
    </article>`;
  }

  function featureHTML(a){
    return `<article class="feature-card" role="listitem">
      <span class="badge">${a.badge||'Featured'}</span>
      <strong>${a.name}</strong>
      <p class="desc">${a.desc}</p>
      <a class="open" aria-label="Open ${a.name}" href="${a.path}">Open <span class="chev">â€º</span></a>
    </article>`;
  }

  function buildIndex(){
    CARD_INDEX.clear();
    [...grid.children].forEach(card=>{
      const text = (card.querySelector('h3')?.textContent||'') + ' ' +
                   (card.querySelector('.desc')?.textContent||'') + ' ' +
                   (JSON.parse(card.dataset.tags||'[]').join(' '));
      CARD_INDEX.set(card, text.toLowerCase());
    });
  }

  function applyFilters(){
    const query = (q.value||'').toLowerCase().trim();
    [...grid.children].forEach(card=>{
      const tags = JSON.parse(card.dataset.tags||'[]');
      const matchesTags = [...ACTIVE_TAGS].every(t=>tags.includes(t));
      const matchesQuery = query ? CARD_INDEX.get(card).includes(query) : true;
      card.style.display = (matchesTags && matchesQuery) ? 'grid' : 'none';
    });
  }

  function renderTags(){
    const uniq = [...new Set(ALL_TAGS)].sort();
    tagBar.innerHTML = uniq.map(t=>`<button class="chip" data-tag="${t}" aria-pressed="false">${t}</button>`).join('');
    tagBar.querySelectorAll('.chip').forEach(btn=>{
      btn.addEventListener('click',()=>{
        const t = btn.dataset.tag;
        const on = btn.getAttribute('aria-pressed')==='true';
        btn.setAttribute('aria-pressed', String(!on));
        on ? ACTIVE_TAGS.delete(t) : ACTIVE_TAGS.add(t);
        applyFilters();
      });
      btn.addEventListener('keydown',e=>{ if(e.key===' '||e.key==='Enter'){e.preventDefault();btn.click();} });
    });
  }

  // Fetch and render
  fetch('catalog.json', {cache:'no-store'})
    .then(r=>r.json())
    .then(json=>{
      DATA = json.apps;
      strip.innerHTML = (json.featured||[]).map(name => {
        const a = DATA.find(x=>x.name===name);
        return a ? featureHTML(a) : '';
      }).join('');
      grid.innerHTML = DATA.map(a=>{ ALL_TAGS.push(...a.tags); return cardHTML(a); }).join('');
      buildIndex(); renderTags();
    })
    .catch(err=>{
      strip.innerHTML = `<div role="alert" class="feature-card">Failed to load catalog.json<br><small>${err}</small></div>`;
    });

  q.addEventListener('input', applyFilters);
</script>
</body>
</html>

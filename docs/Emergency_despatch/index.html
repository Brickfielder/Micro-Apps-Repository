<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Emergency Dispatch ‚Äî Executive Function Trainer</title>
  <style>
    :root{
      --bg:#0b132b;--card:#1c2541;--surface:#243b55;--border:#3a506b;--text:#f5f7fa;--muted:#9fb3c8;
      --primary:#4dd0e1;--success:#22c55e;--warning:#f59e0b;--danger:#ef4444;--accent:#a78bfa;
    }
    *{box-sizing:border-box}
    html,body{margin:0;height:100%;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,"Helvetica Neue",Arial,sans-serif;background:var(--bg);color:var(--text)}
    .container{height:100vh;display:grid;grid-template-rows:auto 1fr auto}
    header{background:var(--card);border-bottom:2px solid var(--border);padding:12px 16px;display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}
    h1{margin:0;font-size:20px;color:var(--primary);display:flex;align-items:center;gap:8px}
    .status{display:flex;gap:16px;font-weight:600}
    .timer{color:var(--warning);font-variant-numeric:tabular-nums}
    .btn{background:var(--surface);border:1px solid var(--border);color:var(--text);padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:700}
    .btn:hover:not(:disabled){filter:brightness(1.08)}
    .btn:disabled{opacity:.55;cursor:not-allowed}
    .btn.primary{background:var(--accent);border-color:var(--accent)}
    .btn.success{background:var(--success);border-color:var(--success)}

    main{display:grid;grid-template-columns:300px 1fr 320px;gap:2px;background:var(--border);min-height:0}
    .panel{background:var(--card);padding:14px;overflow:auto}

    .instructions{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:12px;font-size:13px;line-height:1.4;margin-bottom:12px}

    .protocol-card{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:10px;margin-bottom:8px}
    .protocol-card.active{outline:2px solid var(--warning);background:rgba(245,158,11,.08)}

    /* Map */
    .map{position:relative;height:100%;min-height:360px;background:radial-gradient(1200px 600px at center, #132238 0%, #0b132b 70%);display:flex;align-items:center;justify-content:center;overflow:hidden}
    .grid{position:absolute;inset:10% 15%;border:3px dashed #5aa9ff;border-radius:14px;pointer-events:none;box-shadow:0 0 0 2px rgba(90,169,255,.25) inset}
    /* Incidents are constrained to this layer so they stay inside the square */
    #mapLayer{position:absolute;inset:10% 15%;}

    /* Big, bold compass labels */
    .district{
      position:absolute;
      font-size:22px;
      font-weight:900;
      letter-spacing:2px;
      padding:6px 10px;
      background:rgba(0,0,0,.55);
      border:2px solid rgba(255,255,255,.35);
      border-radius:10px;
      color:#fff;
      text-shadow:0 0 6px rgba(0,0,0,.8);
      filter:drop-shadow(0 4px 8px rgba(0,0,0,.4));
      user-select:none;
      pointer-events:none;
    }
    .district.n{top:4%;left:50%;transform:translateX(-50%)}
    .district.s{bottom:4%;left:50%;transform:translateX(-50%)}
    .district.w{left:6%;top:50%;transform:translateY(-50%) rotate(-90deg)}
    .district.e{right:6%;top:50%;transform:translateY(-50%) rotate(90deg)}

    .compass{
      position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
      background:rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.25);
      border-radius:999px;
      padding:6px 10px;
      font-size:12px; color:#fff;
      letter-spacing:1px;
      user-select:none; pointer-events:none;
    }

    .incident{position:absolute;transform:translate(-50%,-50%);padding:6px 8px;border-radius:999px;border:1px solid;display:flex;gap:6px;align-items:center;font-size:12px;background:var(--surface);box-shadow:0 4px 16px rgba(0,0,0,.35)}
    .incident.med{border-color:#00e5ff}
    .incident.fire{border-color:#ff9800}
    .incident.pol{border-color:#90caf9}
    .incident.selected{outline:2px solid var(--primary)}
    .pulse{position:absolute;inset:-6px;border-radius:999px;border:2px solid currentColor;opacity:.6;animation:pulse 1.4s infinite}
    @keyframes pulse{0%{transform:scale(.8);opacity:.7}70%{transform:scale(1.25);opacity:.1}100%{transform:scale(1.3);opacity:0}}

    .stats{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:10px}
    .stat{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:8px;text-align:center;font-size:12px}

    .mem{display:flex;gap:6px;flex-wrap:wrap;margin:8px 0 14px}
    .chip{background:#0e1b2a;border:1px solid var(--border);border-radius:999px;padding:4px 8px;font-size:11px}

    .inc-list .row{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:8px;margin-bottom:8px;display:grid;grid-template-columns:1fr auto;gap:8px}
    .row .meta{font-size:12px;color:var(--muted)}
    .row.selected{outline:2px solid var(--primary)}

    .controls{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}

    footer{background:var(--card);border-top:2px solid var(--border);padding:8px 16px;display:flex;justify-content:center;gap:12px;color:var(--muted);font-size:12px}

    .modal{position:fixed;inset:0;background:rgba(0,0,0,.75);display:none;align-items:center;justify-content:center;z-index:50}
    .modal .content{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:22px;max-width:520px;width:92%}
    .content h3{margin:0 0 8px;color:var(--primary)}

    .tag{font-size:10px;background:#0e1b2a;border:1px solid var(--border);padding:2px 6px;border-radius:999px}

    .toolbar{display:flex;gap:8px;align-items:center}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="toolbar">
        <h1>üö® Emergency Dispatch</h1>
        <div class="status">
          <span>Level: <strong id="level">1</strong></span>
          <span>Score: <strong id="score">0</strong></span>
          <span class="timer">Time: <strong id="timer">--:--</strong></span>
        </div>
      </div>
      <div class="toolbar">
        <button class="btn primary" id="startBtn">Start New Shift</button>
        <button class="btn" id="pauseBtn" disabled>Pause</button>
        <button class="btn" id="downloadBtn" disabled>Download CSV</button>
      </div>
    </header>

    <main>
      <section class="panel">
        <div class="instructions">
          <strong>Briefing</strong><br>
          Assign the <em>right unit</em> to each incident. Incidents spawn only <em>inside the square</em>.
          <br><br>
          <strong>Session length:</strong> fixed at <strong>3:00</strong> per shift. Session ends early if <strong>more than 8</strong> incidents are pending.
          <br><br>
          Watch the big <strong>NORTH / SOUTH / EAST / WEST</strong> labels. Some protocols <em>restrict</em> dispatches by direction.
        </div>
        <h3 style="margin:8px 0">Active Protocols</h3>
        <div id="protocols"></div>
        <h3 style="margin:12px 0 6px">Working Memory</h3>
        <div id="wmBar" class="mem"></div>
      </section>

      <section class="map">
        <div class="grid" id="grid"></div>
        <div class="district n">NORTH</div>
        <div class="district s">SOUTH</div>
        <div class="district w">WEST</div>
        <div class="district e">EAST</div>
        <div class="compass">N ‚Ä¢ E ‚Ä¢ S ‚Ä¢ W</div>
        <div id="mapLayer"></div>
      </section>

      <section class="panel">
        <div class="stats">
          <div class="stat"><div>Success</div><strong id="success">--%</strong></div>
          <div class="stat"><div>Resolved</div><strong id="resolved">0</strong></div>
          <div class="stat"><div>Errors</div><strong id="errors">0</strong></div>
        </div>

        <h3 style="margin:8px 0">Incidents</h3>
        <div class="inc-list" id="incList"></div>

        <h3 style="margin:12px 0 6px">Dispatch</h3>
        <div class="controls">
          <button class="btn" id="btnAmb" disabled>üöë Ambulance</button>
          <button class="btn" id="btnFire" disabled>üöí Fire</button>
          <button class="btn" id="btnPol" disabled>üöì Police</button>
          <button class="btn success" id="btnHold" disabled>‚è≥ Hold</button>
        </div>

        <div style="margin-top:12px;font-size:12px;color:var(--muted)">
          <span class="tag">Executive Skills: Working Memory ‚Ä¢ Flexibility ‚Ä¢ Inhibition</span>
        </div>
      </section>
    </main>

    <footer>
      <span>Prototype ‚Äî self-contained, no external libraries</span>
      <span>‚Ä¢</span>
      <span>Made for cognitive rehab research</span>
    </footer>
  </div>

  <div class="modal" id="resultModal">
    <div class="content">
      <h3 id="resultTitle">Shift Complete</h3>
      <p id="resultBody"></p>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px">
        <button class="btn" id="closeModal">Close</button>
        <button class="btn primary" id="nextLevel">Next Level</button>
      </div>
    </div>
  </div>

  <script>
    // --- Types & Data ---
    const TYPES = {
      med: {label:'Medical', icon:'ü©∫', needs:'ambulance'},
      fire:{label:'Fire',    icon:'üî•', needs:'fire'},
      pol: {label:'Police',  icon:'üö®', needs:'police'}
    };

    const BASE_PROTOCOL = { name:'Baseline', rule:'Match correct unit to incident type.' };

    const RESTRICTION_POOL = [
      {unit:'police', dir:'NORTH'}, {unit:'police', dir:'SOUTH'}, {unit:'police', dir:'EAST'}, {unit:'police', dir:'WEST'},
      {unit:'fire', dir:'NORTH'},   {unit:'fire', dir:'SOUTH'},   {unit:'fire', dir:'EAST'},   {unit:'fire', dir:'WEST'},
      {unit:'ambulance', dir:'NORTH'},{unit:'ambulance', dir:'SOUTH'},{unit:'ambulance', dir:'EAST'},{unit:'ambulance', dir:'WEST'}
    ];

    // --- State ---
    let S = {
      running:false, paused:false,
      level:1, score:0, time:180,
      incidents:[], selected:null, resolved:0, errors:0,
      restrictions:[],
      lastRestrictionsKey:'',
      wm:[],
      log:[],
      spawnProb:0.50,
      ttlFactor:1.25,
      maxOpen:8
    };

    let loops = {tick:null, spawner:null};

    // --- DOM ---
    const el = (id)=>document.getElementById(id);
    const d = {
      level: el('level'), score: el('score'), timer: el('timer'),
      startBtn: el('startBtn'), pauseBtn: el('pauseBtn'), downloadBtn: el('downloadBtn'),
      protocols: el('protocols'), wmBar: el('wmBar'),
      mapLayer: el('mapLayer'), grid: el('grid'),
      incList: el('incList'), success: el('success'), resolved: el('resolved'), errors: el('errors'),
      btnAmb: el('btnAmb'), btnFire: el('btnFire'), btnPol: el('btnPol'), btnHold: el('btnHold'),
      modal: el('resultModal'), resultTitle: el('resultTitle'), resultBody: el('resultBody'),
      closeModal: el('closeModal'), nextLevel: el('nextLevel')
    };

    // --- Helpers ---
    const rnd = (a,b)=>Math.random()*(b-a)+a;
    const pick = arr => arr[Math.floor(Math.random()*arr.length)];
    const fmt = s=>{const m=Math.floor(s/60), x=s%60; return `${String(m).padStart(2,'0')}:${String(x).padStart(2,'0')}`};
    const shuffle = arr => arr.map(v=>[Math.random(),v]).sort((a,b)=>a[0]-b[0]).map(v=>v[1]);
    function pickMany(pool, n){ const a = shuffle(pool).slice(0, n); a.sort((A,B)=>A.unit.localeCompare(B.unit)||A.dir.localeCompare(B.dir)); return a; }
    function restrKey(list){ return list.map(r=>`${r.unit}-${r.dir}`).join('|'); }
    function capitalize(s){ return s.charAt(0).toUpperCase()+s.slice(1); }

    function forceStop(){
      clearInterval(loops.tick); clearInterval(loops.spawner);
      S.running=false; S.paused=false;
      d.pauseBtn.textContent='Pause'; d.pauseBtn.disabled=true; d.downloadBtn.disabled=true; d.startBtn.disabled=false;
      d.mapLayer.innerHTML='';
      S.incidents=[];
    }

    function reset(level=1){
      S.level=level;
      S.score=0; S.time=180;
      S.selected=null; S.resolved=0; S.errors=0;
      S.wm=[]; S.log=[];
      S.spawnProb = 0.50; S.ttlFactor = 1.25; S.maxOpen = 8;
      d.modal.style.display='none';
      d.mapLayer.innerHTML='';

      let chosen = []; let key='';
      const n = 2 + Math.floor(Math.random()*2); // 2 or 3
      for(let tries=0; tries<10; tries++){
        chosen = pickMany(RESTRICTION_POOL, n);
        key = restrKey(chosen);
        if(key !== S.lastRestrictionsKey) break;
      }
      S.restrictions = chosen;
      S.lastRestrictionsKey = key;

      renderProtocols(); renderWM(); updateAll();
    }

    function pushWM(text){
      S.wm.push(text);
      const cap = 4 + S.level; if(S.wm.length>cap) S.wm.shift();
      renderWM();
    }

    // Ensure map layer has computed size before spawning
    function whenMapReady(cb, tries=0){
      const rect = d.mapLayer.getBoundingClientRect();
      if(rect.width>50 && rect.height>50){ cb(rect); return; }
      if(tries>40){ console.warn('Map layer never sized; proceeding with defaults.'); cb({width:400, height:300}); return; }
      requestAnimationFrame(()=>whenMapReady(cb, tries+1));
    }

    // --- Incident factory ---
    function spawnIncident(){
      if(!S.running) return;
      whenMapReady((rect)=>{
        const x = rnd(16, rect.width-16);
        const y = rnd(16, rect.height-16);
        const typeKey = pick(['med','fire','pol']);

        const NS = (y < rect.height/2) ? 'NORTH' : 'SOUTH';
        const EW = (x < rect.width/2) ? 'WEST'  : 'EAST';
        const zone = `${NS}-${EW}`;

        const baseTTL = {med:30, fire:36, pol:33}[typeKey];
        const ttl = Math.round(baseTTL * S.ttlFactor);
        const id = 'inc_'+Math.random().toString(36).slice(2);
        const inc = {id, type:typeKey, label:`${TYPES[typeKey].icon} ${TYPES[typeKey].label}`, x, y, ttl, status:'open', zone, NS, EW};

        S.incidents.push(inc);
        mountIncident(inc);
        logEvent('spawn', inc);

        if(S.incidents.length > S.maxOpen){ stop('Overload: too many open incidents'); }
      });
    }

    function mountIncident(inc){
      const node = document.createElement('div');
      node.className = `incident ${inc.type}`;
      node.id = inc.id;
      node.style.left = inc.x+'px';
      node.style.top = inc.y+'px';
      node.style.color = inc.type==='med'? '#00e5ff' : inc.type==='fire'? '#f59e0b' : '#90caf9';
      node.innerHTML = `<span class="pulse"></span><span>${inc.label}</span>`;
      node.addEventListener('click',()=>selectIncident(inc.id));
      d.mapLayer.appendChild(node);
      renderIncList();
    }

    function unmountIncident(id){
      const n = document.getElementById(id); if(n) n.remove();
      renderIncList();
    }

    function selectIncident(id){
      S.selected = id;
      document.querySelectorAll('.row').forEach(r=>r.classList.toggle('selected', r.dataset.id===id));
      document.querySelectorAll('.incident').forEach(n=>n.classList.toggle('selected', n.id===id));
      updateButtons();
    }

    function violatesDirectionalRule(kind, inc){
      const attempted = kind;
      for(const r of S.restrictions){
        if(r.unit===attempted && (inc.NS===r.dir || inc.EW===r.dir)){
          return `No ${capitalize(r.unit)} in ${r.dir}`;
        }
      }
      return null;
    }

    function isRestrictedForNeeded(inc){
      const needs = TYPES[inc.type].needs;
      return S.restrictions.some(r => r.unit === needs && (inc.NS === r.dir || inc.EW === r.dir));
    }

    function dispatch(kind){
      const inc = S.incidents.find(i=>i.id===S.selected);
      if(!inc) return;
      const needs = TYPES[inc.type].needs;

      const ruleMsg = violatesDirectionalRule(kind, inc);
      if(ruleMsg){
        S.errors++; S.score = Math.max(0, S.score-3);
        pushWM('Rule violated: '+ruleMsg);
        logEvent('error:rule', inc, {rule:ruleMsg, attempted:kind});
        updateAll();
        return;
      }

      const correct = (kind===needs);

      if(!correct){
        S.errors++; S.score = Math.max(0, S.score-5);
        pushWM('Error: wrong unit');
        logEvent('error:wrong', inc, {attempted:kind});
      } else {
        S.score += 20; S.resolved++;
        pushWM(`Handled: ${inc.label}`);
        logEvent('dispatch:'+kind, inc);
        S.incidents = S.incidents.filter(x=>x.id!==inc.id);
        unmountIncident(inc.id);
      }
      updateAll();
    }

    function hold(){
      const inc = S.incidents.find(i=>i.id===S.selected);
      if(!inc) return;
      inc.ttl += 8; inc.status='open';
      S.score += 3; pushWM(`Hold: ${inc.label}`); logEvent('dispatch:hold', inc);
      updateAll();
    }

    // --- Timers / Loops ---
    function start(){
      if(S.running) return;
      S.running=true; S.paused=false;
      d.startBtn.disabled=true; d.pauseBtn.disabled=false; d.downloadBtn.disabled=false;
      // spawn initial incidents after layout is ready
      whenMapReady(()=>{
        for(let i=0;i<2;i++) spawnIncident();
      });
      loops.tick = setInterval(()=>{ if(!S.paused){ advanceSecond(); } },1000);
      loops.spawner = setInterval(()=>{ if(!S.paused && Math.random()< S.spawnProb) spawnIncident(); }, 3000);
      updateAll();
    }

    function pause(){
      if(!S.running) return; S.paused = !S.paused; d.pauseBtn.textContent = S.paused? 'Resume' : 'Pause';
      updateAll();
    }

    function stop(endTitle='Shift Ended'){
      S.running=false; S.paused=false;
      clearInterval(loops.tick); clearInterval(loops.spawner);
      d.startBtn.disabled=false; d.pauseBtn.disabled=true;
      d.resultTitle.textContent = endTitle;
      const success = successRate();
      d.resultBody.innerHTML = `
        <div><strong>Level:</strong> ${S.level}</div>
        <div><strong>Score:</strong> ${S.score}</div>
        <div><strong>Success:</strong> ${success}%</div>
        <div><strong>Resolved:</strong> ${S.resolved}</div>
        <div><strong>Errors:</strong> ${S.errors}</div>`;
      d.modal.style.display='flex';
      updateAll();
    }

    function advanceSecond(){
      S.time--; if(S.time<=0) { stop('Time Up'); return; }
      for (const inc of [...S.incidents]) {
        inc.ttl--;
        if (inc.ttl <= 0) {
          S.incidents = S.incidents.filter(x => x.id !== inc.id);
          unmountIncident(inc.id);

          if (isRestrictedForNeeded(inc)) {
            pushWM(`Expired (restricted): ${inc.label}`);
            logEvent('expire:restricted', inc);
          } else {
            S.errors++;
            pushWM(`Missed: ${inc.label}`);
            logEvent('expire', inc);
          }
        }
      }
      if(S.incidents.length> S.maxOpen){ stop('Overload: too many open incidents'); return; }
      if(S.resolved >= 5 + S.level){ S.level++; pushWM(`Level ${S.level}`); }
      const open = S.incidents.length; const succ = successRate();
      if(open>5 || succ<70){ S.spawnProb = 0.40; S.ttlFactor = 1.35; }
      else if(succ>85 && open<3){ S.spawnProb = 0.65; S.ttlFactor = 1.05; }
      else { S.spawnProb = 0.50; S.ttlFactor = 1.20; }
      updateAll();
    }

    // --- Rendering ---
    function renderProtocols(){
      d.protocols.innerHTML='';
      const base = document.createElement('div'); base.className='protocol-card active';
      base.innerHTML = `<strong>${BASE_PROTOCOL.name}</strong><br><small>${BASE_PROTOCOL.rule}</small>`;
      d.protocols.appendChild(base);
      for(const r of S.restrictions){
        const card = document.createElement('div'); card.className='protocol-card active';
        card.innerHTML = `<strong>Restriction</strong><br><small>üö´ No ${capitalize(r.unit)} in <strong>${r.dir}</strong></small>`;
        d.protocols.appendChild(card);
      }
    }

    function renderWM(){
      d.wmBar.innerHTML='';
      for(const t of S.wm){ const c=document.createElement('span'); c.className='chip'; c.textContent=t; d.wmBar.appendChild(c);}
    }

    function renderIncList(){
      d.incList.innerHTML='';
      const sorted = [...S.incidents].sort((a,b)=> a.ttl - b.ttl);
      for(const inc of sorted){
        const row = document.createElement('div'); row.className='row';
        row.dataset.id = inc.id;
        row.innerHTML = `
          <div>
            <strong>${inc.label}</strong>
            <span class="tag">Needs: ${TYPES[inc.type].needs}</span>
            <span class="tag">Zone: ${inc.zone}</span>
            <div class="meta">TTL: ${inc.ttl}s ‚Ä¢ Status: ${inc.status}</div>
          </div>`;
        row.addEventListener('click',()=>selectIncident(inc.id));
        d.incList.appendChild(row);
      }
      if(S.selected && !S.incidents.find(i=>i.id===S.selected)) S.selected=null;
      updateButtons();
    }

    function updateButtons(){
      const has = !!S.selected; d.btnAmb.disabled=!has; d.btnFire.disabled=!has; d.btnPol.disabled=!has; d.btnHold.disabled=!has;
    }

    function successRate(){
      const total = S.resolved + S.errors; return total? Math.round((S.resolved/total)*100) : 100;
    }

    function updateAll(){
      d.level.textContent = S.level; d.score.textContent = S.score; d.timer.textContent = fmt(S.time);
      d.resolved.textContent = S.resolved; d.errors.textContent = S.errors; d.success.textContent = successRate()+"%";
      renderIncList();
    }

    // --- Logging / CSV ---
    function logEvent(action, inc, extra={}){
      S.log.push({
        ts:new Date().toISOString(),
        level:S.level,
        timeLeft:S.time,
        action,
        type:inc?.type||'',
        incId:inc?.id||'',
        zone:inc?.zone||'',
        NS:inc?.NS||'',
        EW:inc?.EW||'',
        ...extra
      });
    }

    function toCSV(){
      const cols = ['ts','level','timeLeft','action','type','incId','zone','NS','EW','rule','attempted'];
      const lines = [cols.join(',')].concat(S.log.map(r=>
        cols.map(k=>String(r[k]??'').replaceAll('"','""'))
            .map(x=>/[,"\n]/.test(x)?`"${x}"`:x).join(',')
      ));
      return lines.join('\n');
    }

    function download(){
      const blob = new Blob([toCSV()], {type:'text/csv'});
      const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `dispatch_log_level${S.level}.csv`; a.click(); URL.revokeObjectURL(a.href);
    }

    // --- Events ---
    d.startBtn.addEventListener('click', ()=>{
      if(S.running){ forceStop(); }
      reset(1);
      start();
    });

    d.pauseBtn.addEventListener('click', pause);
    d.downloadBtn.addEventListener('click', download);
    d.btnAmb.addEventListener('click', ()=>dispatch('ambulance'));
    d.btnFire.addEventListener('click', ()=>dispatch('fire'));
    d.btnPol.addEventListener('click',  ()=>dispatch('police'));
    d.btnHold.addEventListener('click', hold);

    d.closeModal.addEventListener('click', ()=>{ d.modal.style.display='none'; });
    d.nextLevel.addEventListener('click', ()=>{ d.modal.style.display='none'; reset(S.level+1); start(); });

    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') stop(); })

    // Init (wait for DOM layout before first reset just to be safe)
    window.addEventListener('load', ()=>reset(1));
  </script>
</body>
</html>
